<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TiffyAI Secure Lock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the passkey system */
        body {
            font-family: 'Orbitron', sans-serif;
        }

        /* Basic animation for the lock icon */
        @keyframes spin-lock {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }

        .lock-icon-spin {
            animation: spin-lock 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Animation for a successful unlock */
        @keyframes unlock-glow {
            from { box-shadow: 0 0 15px rgba(255, 255, 255, 0.5); }
            to { box-shadow: 0 0 50px rgba(0, 255, 0, 0.8); }
        }
        
        .success-glow {
            animation: unlock-glow 1s ease-in-out forwards;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <!-- Main container for the lock interface -->
    <div class="flex flex-col items-center justify-center p-8 bg-gray-800 rounded-2xl shadow-2xl space-y-8 w-full max-w-sm border-2 border-purple-700 bg-opacity-70 transition-all duration-500">
        
        <!-- Header and title -->
        <div class="text-center space-y-2">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">TiffyAI System</h1>
            <p class="text-gray-400" id="header-text">Authenticating...</p>
        </div>

        <!-- Lock icon, styled as a visual element -->
        <div class="relative p-6 rounded-full bg-gray-700 transition-colors duration-300 shadow-lg border border-purple-500">
            <!-- SVG for a modern lock icon -->
            <svg class="w-16 h-16 text-purple-400 lock-icon-spin" id="lock-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 1L4 5v6c0 5.55 3.84 10.74 9 12a15.02 15.02 0 005-2.26V9h-2V7h2V5.5c0-1.93-1.57-3.5-3.5-3.5S12 2.57 12 4.5V6H8v2h4v2h2v-2h2v-2h-2V4.5c0-1.93-1.57-3.5-3.5-3.5z"/>
            </svg>
        </div>

        <!-- Container for the setup interface -->
        <div id="setup-container" class="w-full space-y-4 hidden">
            <input type="password" id="new-passkey" placeholder="Create Passkey"
                   class="w-full p-3 text-center bg-gray-700 text-gray-200 rounded-xl placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors">
            <input type="password" id="confirm-passkey" placeholder="Confirm Passkey"
                   class="w-full p-3 text-center bg-gray-700 text-gray-200 rounded-xl placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors">
            <button id="set-passkey-button" class="w-full p-3 rounded-xl bg-purple-600 text-white font-bold text-lg hover:bg-purple-700 transition-colors duration-300 shadow-md">
                Set Passkey
            </button>
        </div>

        <!-- Container for the unlock interface -->
        <div id="unlock-container" class="w-full space-y-4 hidden">
            <input type="password" id="unlock-passkey" placeholder="Enter Passkey"
                   class="w-full p-3 text-center bg-gray-700 text-gray-200 rounded-xl placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors">
            <button id="unlock-button" class="w-full p-3 rounded-xl bg-purple-600 text-white font-bold text-lg hover:bg-purple-700 transition-colors duration-300 shadow-md">
                Unlock
            </button>
        </div>

        <!-- Status message area -->
        <p id="status-message" class="text-center h-6"></p>
        
    </div>

    <script>
        // Use a simple, non-cryptographic hashing function to obfuscate the stored passkey
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0; // Convert to 32bit integer
            }
            return hash;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Get all relevant DOM elements
            const headerText = document.getElementById('header-text');
            const setupContainer = document.getElementById('setup-container');
            const newPasskeyInput = document.getElementById('new-passkey');
            const confirmPasskeyInput = document.getElementById('confirm-passkey');
            const setPasskeyButton = document.getElementById('set-passkey-button');

            const unlockContainer = document.getElementById('unlock-container');
            const unlockPasskeyInput = document.getElementById('unlock-passkey');
            const unlockButton = document.getElementById('unlock-button');

            const statusMessage = document.getElementById('status-message');
            const lockSvg = document.getElementById('lock-svg');

            // Check if a passkey has already been set and stored
            const storedPasskeyHash = localStorage.getItem('tiffy_passkey');

            // Function to show an error message
            function showError(message) {
                statusMessage.textContent = message;
                statusMessage.classList.remove('text-green-500');
                statusMessage.classList.add('text-red-500');

                // Clear the error message after a few seconds
                setTimeout(() => {
                    statusMessage.textContent = '';
                }, 3000);
            }

            // Function to handle the success state and redirect
            function showSuccess() {
                statusMessage.textContent = "Access Granted!";
                statusMessage.classList.remove('text-red-500');
                statusMessage.classList.add('text-green-500');
                
                // Change the lock icon's appearance for success
                document.querySelector('div.relative').classList.add('success-glow');
                lockSvg.classList.remove('lock-icon-spin');
                lockSvg.classList.remove('text-purple-400');
                lockSvg.classList.add('text-green-500');

                // Delay the redirect to allow the user to see the success state
                setTimeout(() => {
                    window.location.href = "https://tiffyai.github.io/Play";
                }, 1500); // Redirect after 1.5 seconds
            }

            // Function to handle the initial setup of the passkey
            function handlePasskeySetup() {
                const newPasskey = newPasskeyInput.value;
                const confirmPasskey = confirmPasskeyInput.value;

                if (newPasskey === '') {
                    showError("Passkey cannot be empty.");
                    return;
                }

                if (newPasskey !== confirmPasskey) {
                    showError("Passkeys do not match.");
                    return;
                }

                // Store the hashed passkey in localStorage
                const hashedPasskey = simpleHash(newPasskey);
                localStorage.setItem('tiffy_passkey', hashedPasskey);

                // Show success message and transition to unlock screen
                statusMessage.textContent = "Passkey set successfully!";
                statusMessage.classList.add('text-green-500');

                setTimeout(() => {
                    // Hide setup, show unlock
                    setupContainer.classList.add('hidden');
                    unlockContainer.classList.remove('hidden');
                    headerText.textContent = 'Enter Passkey to Authenticate';
                    statusMessage.textContent = ''; // Clear status message
                }, 1000);
            }

            // Function to handle the unlock process
            function handleUnlock() {
                const enteredPasskey = unlockPasskeyInput.value;
                const enteredPasskeyHash = simpleHash(enteredPasskey);

                if (enteredPasskeyHash === parseInt(storedPasskeyHash, 10)) {
                    showSuccess();
                } else {
                    showError("Incorrect Passkey. Access Denied.");
                }
            }

            // Initialize the correct view based on localStorage
            if (storedPasskeyHash) {
                // Passkey exists, show the unlock screen
                unlockContainer.classList.remove('hidden');
                headerText.textContent = 'Enter Passkey to Authenticate';
            } else {
                // No passkey found, show the setup screen
                setupContainer.classList.remove('hidden');
                headerText.textContent = 'Set Your Secure Passkey';
            }

            // Add event listeners based on the visible container
            setPasskeyButton.addEventListener('click', handlePasskeySetup);
            unlockButton.addEventListener('click', handleUnlock);
            
            // Allow 'Enter' key to submit forms
            newPasskeyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handlePasskeySetup();
            });
            confirmPasskeyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handlePasskeySetup();
            });
            unlockPasskeyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleUnlock();
            });
        });
    </script>
</body>
</html>
